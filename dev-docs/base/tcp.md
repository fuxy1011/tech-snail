# TCP三次握手四次挥手

## 三次握手

> 建立连接前，客户端和服务端需要通过握手来确认对方:

* 客户端发送 syn(同步序列编号) 请求，进入 syn_send 状态，等待确认
* 服务端接收并确认 syn 包后发送 syn+ack 包，进入 syn_recv 状态
* 客户端接收 syn+ack 包后，发送 ack 包，双方进入 established 状态

> 类比 我要练习 火影忍者 的黄色闪电 忍术，同时光速传递些东西。但需要先标记。

* 我把信物绑在1个鸽子上，飞鸽传书给 发小，此时进入发送状态，等待发小确认。
* 发小收到并确认信物后，将信物及回复 打包成一个整体 后 再次绑定在鸽子上，飞鸽传书回来给我。此时进入接收状态
* 我收到 发小给我的回复(标记成功)后，和发小之间就可以拥有一条供黄色闪电光速传递的双向通道了。

## TCP四次挥手

> 概要

* 客户端 -- FIN --> 服务端， FIN—WAIT
* 服务端 -- ACK --> 客户端， CLOSE-WAIT
* 服务端 -- ACK,FIN --> 客户端， LAST-ACK
* 客户端 -- ACK --> 服务端，CLOSED

> 类比 疫情需要，要关闭黄色闪电光速通道了，防止感染或传播疫情

* 我 通过 黄色闪电 通道 发“这条是最后1次交易了啊，现在疫情比较严重，通道暂时关了哈”，此时进入等待确认阶段。
* 发小，通过 黄色闪电 通道 接收到消息后 ，认同观点，然后顺手把自己负责的通过关了。此时进行服务器关闭阶段
* 发小，通过 黄色闪电 通道 将通道关闭的消息，回传给我最后一次消息：发“恩行。的确是疫情比较严重，我同意你的意见，我已经把我这关了”
* 我收到回复后，也关闭了自己负责的通道。至此 双向通道都已关闭。

## 参考

[中高级前端大厂面试秘籍，为你保驾护航金三银四，直通大厂(上)](https://juejin.im/post/5c64d15d6fb9a049d37f9c20)  